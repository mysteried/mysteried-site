<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>ミステリード – 街で解く物語</title>
    <link rel="icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./css/base.css" />
    <link rel="stylesheet" href="./css/home.css" />
</head>

<body class="page-home">
    <!-- Header -->
    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="./">ミステリード</a>
            <nav class="nav">
                <a href="./index.html">ホーム</a>
                <a href="./news.html">お知らせ</a>
                <a href="./about.html">遊び方</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Hero (任意で差し替えOK) -->
        <section class="hero">
            <div class="hero-overlay"></div>
            <div class="viewport-fader"></div>
            <div class="hero-inner">
                <h1 class="hero-title">まだ行ったことがない街は、沢山ある。</h1>
                <p class="hero-lead">
                    <br>
                    時間はあるけど、行きたい場所がない。<br>
                    人混みも、観光地の雰囲気も、ちょっと苦手。<br>
                    一人で出かけたいけれど、きっかけがない。<br>
                    <br>
                    ミステリードは、そんなあなたのための“旅の謎解き”です。<br>
                    決まった時間も、集合場所もない。旅は、あなたのペースで。
                </p>
            </div>
        </section>

        <!-- All list -->
        <section class="container stack seamless">
            <h2 class="section-cards">配信一覧</h2>

            <!-- カード（NEWは is-new を付ける）?intro=1でここからのアクセスでOPアニメーションを着火させる　　 -->
            <a class="card is-new open-modal reveal" href="#" data-title="文学に埋もれた部屋"
                data-normal="./stories/story-00/stages/01/stage.html?intro=1"
                data-story="./stories/story-00/stages/01h/stage.html?intro=1">
                <div class="card-media">
                    <img src="./assets/images/main-cards/main-card-01.webp" alt="茎と魚は何故消えたのか？ のサムネイル" loading="lazy" />
                    <span class="badge badge-new">NEW</span>
                </div>
                <div class="card-body">
                    <div class="card-title">思い出のコーヒーと胡椒を挽く男</div>
                    <p class="card-desc">
                        商店街に漂う“消えたモチーフ”の噂。看板、レシート、古い掲示板——街の断片から真相へ近づく。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星2">レベル⭐️</span>
                        <span class="chip">埼玉県 秩父</span>
                        <span class="chip">45–90分</span>
                        <span class="chip">10/01配信</span>
                        <span class="chip">車推奨</span>
                        <span class="chip">探偵シリーズ</span>
                    </div>
                </div>
            </a>

            <!-- カード（NEWは is-new を付ける） -->
            <a class="card is-new reveal" href="./stories/story-00/stages/01h/stage.html?intro=1">
                <div class="card-media">
                    <img src="./assets/images/main-cards/main-card-02.webp" alt="茎と魚は何故消えたのか？ のサムネイル" loading="lazy" />
                    <span class="badge badge-new">NEW</span>
                </div>
                <div class="card-body">
                    <div class="card-title">茎と魚は何故消えたのか？</div>
                    <p class="card-desc">
                        商店街に漂う“消えたモチーフ”の噂。看板、レシート、古い掲示板——街の断片から真相へ近づく。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星2">⭐️⭐️☆</span>
                        <span class="chip">埼玉県 秩父</span>
                        <span class="chip">45–90分</span>
                        <span class="chip">10/01配信</span>
                    </div>
                </div>
            </a>

            <a class="card reveal" href="./stories/story-02/">
                <div class="card-media">
                    <img src="./assets/images/main-cards/main-card-03.webp" alt="幼い時の記憶　懐かしの遊具 のサムネイル" loading="lazy" />
                </div>
                <div class="card-body">
                    <div class="card-title">幼い時の記憶　懐かしの遊具</div>
                    <p class="card-desc">
                        なくなった遊具の手がかりを追って、路地裏と屋上をめぐる小さな探偵行。最後に待つのは——。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星1">⭐️☆☆</span>
                        <span class="chip">神奈川県 小田原</span>
                        <span class="chip">30–60分</span>
                        <span class="chip">09/01配信</span>
                    </div>
                </div>
            </a>

            <a class="card reveal" href="./stories/story-03/">
                <div class="card-media">
                    <img src="./assets/images/main-cards/main-card-04.webp" alt="戦艦島 のサムネイル" loading="lazy" />
                </div>
                <div class="card-body">
                    <div class="card-title">戦艦島</div>
                    <p class="card-desc">
                        地図から消えた島影の由来。古写真、社標、倉庫跡——欠けたピースを埋めていく現地パズル。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星3">⭐️⭐️⭐️</span>
                        <span class="chip">福井県 三方五湖</span>
                        <span class="chip">60–120分</span>
                        <span class="chip">08/22配信</span>
                    </div>
                </div>
            </a>

        </section>
        <!-- Mode select modal -->
        <div id="modeModal" class="modal" aria-hidden="true">
            <div class="modal-backdrop" data-close="true"></div>
            <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
                <button class="modal-close" aria-label="閉じる" data-close="true">×</button>

                <h3 id="modeTitle">どちらでプレイしますか？</h3>
                <p class="modal-desc">
                    謎とストーリーの内容はどちらも同じです。<br>
                    <b>通常版</b>は、シンプルに謎解きを楽しむモードです。<br>
                    <b>探偵事務所版</b>は、探偵マスオと助手ヒナタの会話とともに物語を進めます。
                </p>


                <div class="modal-actions">
                    <a id="btnPlain" href="#" class="btn-image">
                        <img src="./assets/images/parts/modal-normal.webp" alt="通常で遊ぶ" width="220" height="auto">
                    </a>
                    <a id="btnStory" href="#" class="btn-image">
                        <img src="./assets/images/parts/modal-story.webp" alt="物語で遊ぶ" width="220" height="auto">
                    </a>
                </div>
                <!-- 記憶モードは変更する動線が確保できないから一時的にアウト -->
                <!-- <label class="remember">
                    <input type="checkbox" id="rememberMode"> 今後この選択を記憶する
                </label> -->
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container footer-inner">
            <small>© 2025 ミステリード</small>
            <nav class="nav">
                <a href="mailto:info@example.com">お問い合わせ</a>
            </nav>
        </div>
    </footer>
    <script>
        (() => {
            const modal = document.getElementById('modeModal');
            const btnPlain = document.getElementById('btnPlain');
            const btnStory = document.getElementById('btnStory');
            const remember = document.getElementById('rememberMode');
            const titleEl = document.getElementById('modeTitle');

            function openModal(normalUrl, storyUrl) {
                titleEl.textContent = 'どちらでプレイしますか？';
                btnPlain.href = normalUrl;
                btnStory.href = storyUrl;
                modal.setAttribute('aria-hidden', 'false');
            }
            function closeModal() {
                modal.setAttribute('aria-hidden', 'true');
            }

            // Delegate clicks from any .open-modal
            document.addEventListener('click', (e) => {
                const trigger = e.target.closest('.open-modal');
                if (trigger) {
                    e.preventDefault();
                    const preferred = localStorage.getItem('playMode'); // 'plain' | 'story'
                    const normal = trigger.dataset.normal;
                    const story = trigger.dataset.story;
                    if (preferred === 'plain') { location.href = normal; return; }
                    if (preferred === 'story') { location.href = story; return; }
                    openModal(normal, story);
                }
                if (e.target.matches('[data-close]')) {
                    closeModal();
                }
            });

            // Remember choice on click
            btnPlain.addEventListener('click', () => {
                if (remember && remember.checked) localStorage.setItem('playMode', 'plain');
            });
            btnStory.addEventListener('click', () => {
                if (remember && remember.checked) localStorage.setItem('playMode', 'story');
            });

            // ESC to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });

            // --- Header scroll glass & active nav ---
            const headerEl = document.querySelector('.site-header');
            const onScrollHeader = () => {
                if (!headerEl) return;
                if ((window.scrollY || window.pageYOffset || 0) > 2) {
                    headerEl.classList.add('scrolled');
                } else {
                    headerEl.classList.remove('scrolled');
                }
            };
            onScrollHeader();
            window.addEventListener('scroll', onScrollHeader, { passive: true });

            // Active nav (簡易版): 現在のパスに一致するリンクに .active
            const navLinks = document.querySelectorAll('.site-header .nav a');
            const path = location.pathname.replace(/\/index\.html$/, '/');
            navLinks.forEach(a => {
                try {
                    const href = a.getAttribute('href');
                    if (!href) return;
                    // 相対パスでの簡易一致
                    if (href === '.' || href === './') {
                        if (path.endsWith('/')) return; // brandは別扱い
                    } else if (path.endsWith(href)) {
                        a.classList.add('active');
                    }
                } catch (_) { /* noop */ }
            });

            // --- Hero scroll-out animation (title -> left, lead -> right) ---
            const heroTitle = document.querySelector('.hero-title');
            const heroLead = document.querySelector('.hero-lead');
            const hero = document.querySelector('.hero');

            if (heroTitle && heroLead) {
                let ticking = false;

                const updateHero = () => {
                    const heroTop = hero.offsetTop;
                    const heroH = hero.offsetHeight || window.innerHeight;
                    // progress within the hero only (0 -> 1)
                    const y = Math.max(0, (window.scrollY || window.pageYOffset || 0) - heroTop);
                    const range = Math.max(1, heroH * 0.8);
                    let p = y / range;
                    if (p < 0) p = 0;
                    if (p > 1) p = 1;

                    // Pure horizontal split, no vertical component
                    const shift = 12 * p; // vw
                    const op = 1 - p;
                    heroTitle.style.transform = `translateX(-${shift}vw)`;
                    heroLead.style.transform = `translateX(${shift}vw)`;
                    heroTitle.style.opacity = op.toFixed(3);
                    heroLead.style.opacity = op.toFixed(3);

                    ticking = false;
                };

                const onScroll = () => {
                    if (!ticking) {
                        window.requestAnimationFrame(updateHero);
                        ticking = true;
                    }
                };

                // Initial paint and listeners (respect reduced motion)
                const reduce = window.matchMedia('(prefers-reduced-motion: reduce)');
                if (!reduce.matches) {
                    updateHero();
                    window.addEventListener('scroll', onScroll, { passive: true });
                    window.addEventListener('resize', onScroll);
                }
            }
        })();
    </script>
</body>

</html>