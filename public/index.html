<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>ミステリアリティ – 街で解く物語</title>
    <link rel="icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./css/base.css" />
    <link rel="stylesheet" href="./css/home.css" />
    <style>
        /* --- Modal (mode selector) --- */
        .modal {
            position: fixed;
            inset: 0;
            display: none;
        }

        .modal[aria-hidden="false"] {
            display: block;
        }

        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, .45);
        }

        .modal-dialog {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .35);
            width: min(92vw, 560px);
            padding: 22px 22px 18px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 12px;
            border: 0;
            background: transparent;
            font-size: 24px;
            line-height: 1;
            cursor: pointer;
        }

        .modal-dialog h3 {
            margin: 0 0 8px;
            font-size: 22px;
            text-align: center;
        }

        .modal-desc {
            margin: 0 0 18px;
            color: #555;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 6px 0 10px;
        }

        .btn-image img {
            border-radius: 10px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-image:hover img {
            transform: scale(1.03);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        }

        .modal-actions .btn {
            display: inline-block;
            padding: 12px 18px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600
        }

        .btn-plain {
            background: #f2f4f8;
            border: 1px solid #d7dbe4;
            color: #1a2a3a
        }

        .btn-story {
            background: #111;
            color: #fff
        }

        .remember {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            color: #555;
            font-size: 14px
        }

        @media (hover:hover) {
            .modal-backdrop:hover {
                cursor: pointer
            }
        }

        body.page-home {
            background: url('./assets/images/sample-03.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        /* --- Hero (overlay + fade) --- */
        .hero {
            position: relative;
            text-align: center;
            color: #fff;
            /* pin the hero area to viewport height so content behind scrolls under it */
            min-height: 100vh;
            display: grid;
            align-items: center;
            padding: 0 20px;
            overflow: hidden;
        }

        .hero-overlay {
            position: fixed;
            /* cover the viewport at all times */
            inset: 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, .45) 0%, rgba(0, 0, 0, .25) 40%, rgba(0, 0, 0, .65) 100%);
            backdrop-filter: blur(4px);
            z-index: 0;
            /* below all content */
            pointer-events: none;
            /* let clicks pass through */
        }

        .viewport-fader {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 160px;
            /* fade length */
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(255, 255, 255, 1) 100%);
            z-index: 1;
            /* above the fixed overlay, below the content */
            pointer-events: none;
            /* let clicks pass through */
        }

        .site-header {
            position: relative;
            z-index: 10;
            /* ensure header sits above the fixed overlay & remains sharp */
        }

        main,
        .site-footer {
            position: relative;
            z-index: 2;
            /* content stays above overlay but below header */
        }

        .hero-inner {
            position: fixed;
            /* pin to the viewport */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            /* center both axes */
            z-index: 2;
            max-width: 880px;
            width: min(92vw, 880px);
            margin: 0 auto;
            padding: 0;
            /* no vertical padding needed */
            text-align: center;
            animation: heroFadeIn 1.2s ease-out;
            pointer-events: none;
            /* let clicks pass through the hero texts when content scrolls under */
        }

        /* Soft fade from the hero into the page */
        /* Removed .hero::after rule */

        .hero-title {
            font-size: clamp(28px, 4vw, 44px);
            font-weight: 700;
            margin-bottom: 24px;
            line-height: 1.4;
            text-shadow: 0 2px 8px rgba(0, 0, 0, .35);
        }

        .hero-lead {
            font-size: clamp(16px, 2vw, 20px);
            line-height: 1.8;
            color: rgba(255, 255, 255, .92);
            text-shadow: 0 1px 4px rgba(0, 0, 0, .3);
        }

        /* --- Hero scroll-out animation (title to left, lead to right) --- */
        .hero-title,
        .hero-lead {
            will-change: transform, opacity;
            transform: translateX(0);
            transition: transform 0s, opacity 0s;
            /* JS drives values; no easing jitter */
        }

        @media (prefers-reduced-motion: reduce) {

            .hero-title,
            .hero-lead {
                transition: none;
            }
        }

        @keyframes heroFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Seamless transition: overlap next section slightly under the hero */
        .stack.seamless {
            position: relative;
            margin-top: 0;
            /* pull section upward into the fade */
            padding-top: 24px;
            /* keep internal spacing */
        }

        /* optional soft top shadow so the cards feel anchored */
        /* Removed .stack.seamless::before rule */
    </style>
</head>

<body class="page-home">
    <!-- Header -->
    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="./">ミステリアリティ</a>
            <nav class="nav">
                <a href="./about.html">遊び方</a>
                <a href="./news.html">お知らせ</a>
            </nav>
        </div>
    </header>

    <main>
        <!-- Hero (任意で差し替えOK) -->
        <section class="hero">
            <div class="hero-overlay"></div>
            <div class="viewport-fader"></div>
            <div class="hero-inner">
                <h1 class="hero-title">今週末、暇ならちょっと遠くへ出掛けてみよう。</h1>
                <p class="hero-lead">
                    混雑した観光地より行ったことがない街へ行きたい・・・<br>
                    時間や休日はあるけど目的地がない・・・<br>
                    一人でも楽しめる旅をしたい・・・<br>
                    参加型の謎解きはしんどい・・・
                </p>
            </div>
        </section>

        <!-- All list -->
        <section class="container stack seamless">
            <h2 class="section-title">エピソード</h2>

            <!-- カード（NEWは is-new を付ける）?intro=1でここからのアクセスでOPアニメーションを着火させる　　 -->
            <a class="card is-new open-modal reveal" href="#" data-title="文学に埋もれた部屋"
                data-normal="./stories/story-00/stages/01/stage.html?intro=1"
                data-story="./stories/story-00/stages/01h/stage.html?intro=1">
                <div class="card-media">
                    <img src="./assets/images/sample-01.jpg" alt="茎と魚は何故消えたのか？ のサムネイル" loading="lazy" />
                    <span class="badge badge-new">NEW</span>
                </div>
                <div class="card-body">
                    <div class="card-title">文学に埋もれた部屋</div>
                    <p class="card-desc">
                        商店街に漂う“消えたモチーフ”の噂。看板、レシート、古い掲示板——街の断片から真相へ近づく。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星2">レベル⭐️</span>
                        <span class="chip">埼玉県 秩父</span>
                        <span class="chip">45–90分</span>
                        <span class="chip">10/01配信</span>
                        <span class="chip">車推奨</span>
                        <span class="chip">探偵シリーズ</span>
                    </div>
                </div>
            </a>

            <!-- カード（NEWは is-new を付ける） -->
            <a class="card is-new reveal" href="./stories/story-00/stages/01h/stage.html?intro=1">
                <div class="card-media">
                    <img src="./assets/images/sample-02.jpg" alt="茎と魚は何故消えたのか？ のサムネイル" loading="lazy" />
                    <span class="badge badge-new">NEW</span>
                </div>
                <div class="card-body">
                    <div class="card-title">茎と魚は何故消えたのか？</div>
                    <p class="card-desc">
                        商店街に漂う“消えたモチーフ”の噂。看板、レシート、古い掲示板——街の断片から真相へ近づく。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星2">⭐️⭐️☆</span>
                        <span class="chip">埼玉県 秩父</span>
                        <span class="chip">45–90分</span>
                        <span class="chip">10/01配信</span>
                    </div>
                </div>
            </a>

            <a class="card reveal" href="./stories/story-02/">
                <div class="card-media">
                    <img src="./assets/images/sample-03.jpg" alt="幼い時の記憶　懐かしの遊具 のサムネイル" loading="lazy" />
                </div>
                <div class="card-body">
                    <div class="card-title">幼い時の記憶　懐かしの遊具</div>
                    <p class="card-desc">
                        なくなった遊具の手がかりを追って、路地裏と屋上をめぐる小さな探偵行。最後に待つのは——。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星1">⭐️☆☆</span>
                        <span class="chip">神奈川県 小田原</span>
                        <span class="chip">30–60分</span>
                        <span class="chip">09/01配信</span>
                    </div>
                </div>
            </a>

            <a class="card reveal" href="./stories/story-03/">
                <div class="card-media">
                    <img src="./assets/images/sample-04.jpg" alt="戦艦島 のサムネイル" loading="lazy" />
                </div>
                <div class="card-body">
                    <div class="card-title">戦艦島</div>
                    <p class="card-desc">
                        地図から消えた島影の由来。古写真、社標、倉庫跡——欠けたピースを埋めていく現地パズル。
                    </p>
                    <div class="meta">
                        <span class="chip" aria-label="難易度 星3">⭐️⭐️⭐️</span>
                        <span class="chip">福井県 三方五湖</span>
                        <span class="chip">60–120分</span>
                        <span class="chip">08/22配信</span>
                    </div>
                </div>
            </a>

        </section>
        <!-- Mode select modal -->
        <div id="modeModal" class="modal" aria-hidden="true">
            <div class="modal-backdrop" data-close="true"></div>
            <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="modeTitle">
                <button class="modal-close" aria-label="閉じる" data-close="true">×</button>
                <h3 id="modeTitle">どちらでプレイしますか？</h3>
                <p class="modal-desc">
                    同じ謎を、演出ちがいで楽しめます。<br>
                    通常版はシンプルな謎解きです。<br>
                    物語版は探偵マスオと助手ヒナタとともになぞを解きます。
                </p>
                <div class="modal-actions">
                    <a id="btnPlain" href="#" class="btn-image">
                        <img src="./assets/images/mode-normal.webp" alt="通常で遊ぶ" width="220" height="auto">
                    </a>
                    <a id="btnStory" href="#" class="btn-image">
                        <img src="./assets/images/mode-story.webp" alt="物語で遊ぶ" width="220" height="auto">
                    </a>
                </div>
                <!-- 記憶モードは変更する動線が確保できないから一時的にアウト -->
                <!-- <label class="remember">
                    <input type="checkbox" id="rememberMode"> 今後この選択を記憶する
                </label> -->
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container footer-inner">
            <small>© 2025 ミステリアリティ</small>
            <nav class="nav">
                <a href="./about.html">遊び方</a>
                <a href="./news.html">お知らせ</a>
                <a href="mailto:info@example.com">お問い合わせ</a>
            </nav>
        </div>
    </footer>
    <script>
        (() => {
            const modal = document.getElementById('modeModal');
            const btnPlain = document.getElementById('btnPlain');
            const btnStory = document.getElementById('btnStory');
            const remember = document.getElementById('rememberMode');
            const titleEl = document.getElementById('modeTitle');

            function openModal(normalUrl, storyUrl) {
                titleEl.textContent = 'どちらでプレイしますか？';
                btnPlain.href = normalUrl;
                btnStory.href = storyUrl;
                modal.setAttribute('aria-hidden', 'false');
            }
            function closeModal() {
                modal.setAttribute('aria-hidden', 'true');
            }

            // Delegate clicks from any .open-modal
            document.addEventListener('click', (e) => {
                const trigger = e.target.closest('.open-modal');
                if (trigger) {
                    e.preventDefault();
                    const preferred = localStorage.getItem('playMode'); // 'plain' | 'story'
                    const normal = trigger.dataset.normal;
                    const story = trigger.dataset.story;
                    if (preferred === 'plain') { location.href = normal; return; }
                    if (preferred === 'story') { location.href = story; return; }
                    openModal(normal, story);
                }
                if (e.target.matches('[data-close]')) {
                    closeModal();
                }
            });

            // Remember choice on click
            btnPlain.addEventListener('click', () => {
                if (remember.checked) localStorage.setItem('playMode', 'plain');
            });
            btnStory.addEventListener('click', () => {
                if (remember.checked) localStorage.setItem('playMode', 'story');
            });

            // ESC to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });

            // --- Hero scroll-out animation (title -> left, lead -> right) ---
            const heroTitle = document.querySelector('.hero-title');
            const heroLead = document.querySelector('.hero-lead');
            const hero = document.querySelector('.hero');

            if (heroTitle && heroLead) {
                let ticking = false;

                const updateHero = () => {
                    const heroTop = hero.offsetTop;
                    const heroH = hero.offsetHeight || window.innerHeight;
                    // progress within the hero only (0 -> 1)
                    const y = Math.max(0, (window.scrollY || window.pageYOffset || 0) - heroTop);
                    const range = Math.max(1, heroH * 0.8);
                    let p = y / range;
                    if (p < 0) p = 0;
                    if (p > 1) p = 1;

                    // Pure horizontal split, no vertical component
                    const shift = 12 * p; // vw
                    const op = 1 - p;
                    heroTitle.style.transform = `translateX(-${shift}vw)`;
                    heroLead.style.transform = `translateX(${shift}vw)`;
                    heroTitle.style.opacity = op.toFixed(3);
                    heroLead.style.opacity = op.toFixed(3);

                    ticking = false;
                };

                const onScroll = () => {
                    if (!ticking) {
                        window.requestAnimationFrame(updateHero);
                        ticking = true;
                    }
                };

                // Initial paint and listeners (respect reduced motion)
                const reduce = window.matchMedia('(prefers-reduced-motion: reduce)');
                if (!reduce.matches) {
                    updateHero();
                    window.addEventListener('scroll', onScroll, { passive: true });
                    window.addEventListener('resize', onScroll);
                }
            }
        })();
    </script>
</body>

</html>